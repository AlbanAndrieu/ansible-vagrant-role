---
- name: vagrant | Create temporary directory
  shell: mktemp -d
  register: tempdir
  become: yes
  tags:
    - vagrant

- name: vagrant | Download vagrant
  get_url: url={{ vagrant_url }} dest={{ vagrant_dir_tmp }}/vagrant.deb force=yes
  become: yes
  tags:
    - vagrant

- name: vagrant | Install vagrant
  command: dpkg -i {{ vagrant_dir_tmp }}/vagrant.deb
  become: yes
  tags:
    - vagrant

- name: vagrant | Install libvirt requirements (Debian only)
  apt: pkg={{ item }} state=present
  when: (ansible_distribution == 'Debian' or ansible_distribution == 'Ubuntu') and vagrant_libvirt_enabled
  become: yes
  with_items:
    - libxslt-dev
    - libxml2-dev
    - libvirt-dev

- name: vagrant | Install libvirt requirements (CentOS only)
  yum: pkg={{ item }} state=present
  when: ansible_distribution == 'CentOS' and vagrant_libvirt_enabled
  become: yes
  with_items:
    - libxslt-devel
    - libxml2-devel
    - libvirt-devel

- name: vagrant | Install libvirt plugin
  command: vagrant plugin install vagrant-libvirt
  become: yes
  ignore_errors: yes
  when: vagrant_libvirt_enabled

- name: vagrant | Install gyoku
  command: gem install gyoku -v '1.2.2'
  when: (ansible_distribution == 'Debian' or ansible_distribution == 'Ubuntu') and vagrant_windows_enabled
  become: yes

- name: vagrant | Install windows plugin
  command: vagrant plugin install vagrant-windows
  become: yes
  ignore_errors: yes
  when: vagrant_windows_enabled

- name: vagrant | Install CFPropertyList
  command: gem install CFPropertyList -v '2.3.0'
  when: (ansible_distribution == 'Debian' or ansible_distribution == 'Ubuntu') and vagrant_lxc_enabled
  become: yes

- name: vagrant | Install lxc plugin
  command: vagrant plugin install vagrant-lxc
  become: yes
  ignore_errors: yes
  when: vagrant_lxc_enabled

- name: vagrant | Install vbguest plugin
  command: vagrant plugin install vagrant-vbguest
  become: yes
  ignore_errors: yes
  when: vagrant_vbguest_enabled

- name: vagrant | Install hosts plugin
  command: vagrant plugin install vagrant-hosts
  become: yes
  ignore_errors: yes
  when: vagrant_hosts_enabled

- name: vagrant | Install share plugin
  command: vagrant plugin install vagrant-share
  become: yes
  ignore_errors: yes
  when: vagrant_share_enabled

- name: vagrant | Install winrm plugin
  command: vagrant plugin install vagrant-winrm
  become: yes
  ignore_errors: yes
  when: vagrant_winrm_enabled

- name: vagrant | Cleanup temporary directory
  file: name={{ vagrant_dir_tmp }} state=absent
  become: yes
  tags:
    - vagrant
  changed_when: false
  ignore_errors: yes
  become: yes
